<div id="disturbance-panel" class="disturbance-panel">
  <div class="disturbance-header">
    <h4>Disturbance Field</h4>
    <button id="disturbance-toggle" class="disturbance-toggle" title="Toggle panel">−</button>
  </div>
  
  <div class="disturbance-controls">
    <div class="control-group">
      <label for="radius-slider">Radius: <span id="radius-value">100</span>px</label>
      <input type="range" id="radius-slider" min="5" max="150" value="100" step="1">
    </div>

    <div class="control-group">
      <label for="strength-slider">Strength: <span id="strength-value">35</span></label>
      <input type="range" id="strength-slider" min="10" max="100" value="35" step="5">
    </div>

    <div class="control-group">
      <label for="force-mult-slider">Force Multiplier: <span id="force-mult-value">0.10</span></label>
      <input type="range" id="force-mult-slider" min="0.05" max="0.5" value="0.10" step="0.05">
    </div>

    <div class="control-group">
      <label for="speed-mult-slider">Speed Sensitivity: <span id="speed-mult-value">0.1</span></label>
      <input type="range" id="speed-mult-slider" min="0" max="0.5" value="0.1" step="0.02">
    </div>

    <div class="control-group">
      <label for="connection-resist-slider">Connection Resistance: <span id="connection-resist-value">0.05</span></label>
      <input type="range" id="connection-resist-slider" min="0" max="0.3" value="0.05" step="0.01">
    </div>

    <div class="control-group">
      <label for="connection-min-slider">Min Force w/ Connections: <span id="connection-min-value">0.30</span></label>
      <input type="range" id="connection-min-slider" min="0.1" max="1" value="0.30" step="0.05">
    </div>

    <button id="disturbance-reset" class="disturbance-reset">Reset to Defaults</button>
  </div>
</div>

<script>
  // Wait for disturbance config to be available
  function initDisturbanceControls() {
    if (!window.DISTURBANCE_CONFIG) {
      setTimeout(initDisturbanceControls, 100);
      return;
    }

    const controls = {
      radius: document.getElementById('radius-slider'),
      strength: document.getElementById('strength-slider'),
      forceMult: document.getElementById('force-mult-slider'),
      speedMult: document.getElementById('speed-mult-slider'),
      connectionResist: document.getElementById('connection-resist-slider'),
      connectionMin: document.getElementById('connection-min-slider')
    };

    const values = {
      radius: document.getElementById('radius-value'),
      strength: document.getElementById('strength-value'),
      forceMult: document.getElementById('force-mult-value'),
      speedMult: document.getElementById('speed-mult-value'),
      connectionResist: document.getElementById('connection-resist-value'),
      connectionMin: document.getElementById('connection-min-value')
    };

    const defaults = {
      RADIUS: 100,
      STRENGTH: 35,
      BASE_FORCE_MULT: 0.10,
      SPEED_MULT: 0.1,
      CONNECTION_RESISTANCE: 0.05,
      CONNECTION_MIN: 0.30
    };

    // Update value display and config on slider change
    controls.radius.addEventListener('input', (e) => {
      const val = parseFloat(e.target.value);
      values.radius.textContent = val;
      window.DISTURBANCE_CONFIG.RADIUS = val;
    });

    controls.strength.addEventListener('input', (e) => {
      const val = parseFloat(e.target.value);
      values.strength.textContent = val;
      window.DISTURBANCE_CONFIG.STRENGTH = val;
    });

    controls.forceMult.addEventListener('input', (e) => {
      const val = parseFloat(e.target.value);
      values.forceMult.textContent = val.toFixed(2);
      window.DISTURBANCE_CONFIG.BASE_FORCE_MULT = val;
    });

    controls.speedMult.addEventListener('input', (e) => {
      const val = parseFloat(e.target.value);
      values.speedMult.textContent = val.toFixed(2);
      window.DISTURBANCE_CONFIG.SPEED_MULT = val;
    });

    controls.connectionResist.addEventListener('input', (e) => {
      const val = parseFloat(e.target.value);
      values.connectionResist.textContent = val.toFixed(2);
      window.DISTURBANCE_CONFIG.CONNECTION_RESISTANCE = val;
    });

    controls.connectionMin.addEventListener('input', (e) => {
      const val = parseFloat(e.target.value);
      values.connectionMin.textContent = val.toFixed(2);
      window.DISTURBANCE_CONFIG.CONNECTION_MIN = val;
    });

    // Reset button
    document.getElementById('disturbance-reset').addEventListener('click', () => {
      controls.radius.value = defaults.RADIUS;
      controls.strength.value = defaults.STRENGTH;
      controls.forceMult.value = defaults.BASE_FORCE_MULT;
      controls.speedMult.value = defaults.SPEED_MULT;
      controls.connectionResist.value = defaults.CONNECTION_RESISTANCE;
      controls.connectionMin.value = defaults.CONNECTION_MIN;

      values.radius.textContent = defaults.RADIUS;
      values.strength.textContent = defaults.STRENGTH;
      values.forceMult.textContent = defaults.BASE_FORCE_MULT.toFixed(2);
      values.speedMult.textContent = defaults.SPEED_MULT.toFixed(2);
      values.connectionResist.textContent = defaults.CONNECTION_RESISTANCE.toFixed(2);
      values.connectionMin.textContent = defaults.CONNECTION_MIN.toFixed(2);

      Object.assign(window.DISTURBANCE_CONFIG, defaults);
    });

    // Toggle panel visibility
    document.getElementById('disturbance-toggle').addEventListener('click', (e) => {
      const panel = document.getElementById('disturbance-panel');
      const button = e.target;
      panel.classList.toggle('collapsed');
      button.textContent = panel.classList.contains('collapsed') ? '+' : '−';
    });
  }

  initDisturbanceControls();
</script>
